"use strict";(()=>{var e={};e.id=312,e.ids=[312],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},8932:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>w,patchFetch:()=>x,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var r={};n.r(r),n.d(r,{POST:()=>c});var a=n(9303),s=n(8716),i=n(670),o=n(7070),u=n(3482);async function c(e){try{if(e.headers.get("authorization")!==`Bearer ${process.env.INIT_SECRET||"init-secret-change-me"}`)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{username:t,password:n}=await e.json();if(!t||!n)return o.NextResponse.json({error:"Username and password required"},{status:400});return await (0,u.uV)(t,n),o.NextResponse.json({success:!0,message:"Admin created"})}catch(e){if(11e3===e.code)return o.NextResponse.json({error:"Admin already exists"},{status:409});return console.error("Error creating admin:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/init/route",pathname:"/api/admin/init",filename:"route",bundlePath:"app/api/admin/init/route"},resolvedPagePath:"C:\\Users\\Admin\\Documents\\Project\\HotShield\\Server\\src\\app\\api\\admin\\init\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:m}=d,w="/api/admin/init/route";function x(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}},8484:(e,t,n)=>{n.d(t,{N:()=>o});let r=require("mongodb"),a=process.env.MONGODB_URI,s={},i=null;async function o(){return(await function(){if(!process.env.MONGODB_URI)throw Error("Please add your Mongo URI to .env.local");return i||(i=new r.MongoClient(a,s).connect())}()).db()}},3482:(e,t,n)=>{n.d(t,{uV:()=>d,ed:()=>p,sd:()=>w,kF:()=>g,ZW:()=>l});var r=n(8484),a=n(2023),s=n.n(a),i=n(4770),o=n.n(i);async function u(){return(await (0,r.N)()).collection("admins")}async function c(){return(await (0,r.N)()).collection("sessions")}async function d(e,t){let n=await u(),r=await s().hash(t,10);await n.insertOne({username:e,passwordHash:r,createdAt:new Date().toISOString()})}async function l(e,t){let n=await u(),r=await n.findOne({username:e});return!!r&&s().compare(t,r.passwordHash)}async function p(e,t){let n=await c(),r=o().randomBytes(32).toString("hex"),a=new Date(Date.now()+864e5).toISOString();return await n.insertOne({sessionId:r,username:e,expiresAt:a,ipAddress:t}),r}async function m(e){let t=await c(),n=await t.findOne({sessionId:e});return n?new Date(n.expiresAt)<new Date?(await t.deleteOne({sessionId:e}),null):n.username:null}async function w(e){let t=await c();await t.deleteOne({sessionId:e})}var x=n(1615);async function g(e){let t=await (0,x.cookies)(),n=e.headers.get("X-Session-Id")||t.get("sessionId")?.value||"";if(!n)return null;let r=await m(n);return r?{username:r}:null}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[276,972,28],()=>n(8932));module.exports=r})();