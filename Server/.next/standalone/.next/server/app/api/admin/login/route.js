"use strict";(()=>{var e={};e.id=672,e.ids=[672],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},6446:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>A});var r={};n.r(r),n.d(r,{POST:()=>w});var a=n(9303),i=n(8716),o=n(670),s=n(7070),c=n(3482),l=n(9713),u=n(8484),d=n(1585),p=n(6033);let m=d.Ry({username:d.Z_().min(1),password:d.Z_().min(1)});async function w(e){try{let t=await e.json(),{username:n,password:r}=m.parse(t),a=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown";if(!await (0,c.ZW)(n,r))return s.NextResponse.json({error:"Invalid credentials"},{status:401});let i=await (0,c.ed)(n,a),o=await (0,u.N)(),d=new l.J(o);await d.log({action:l.V.ADMIN_LOGIN,actor:n,timestamp:new Date().toISOString(),ipAddress:a});let p=s.NextResponse.json({success:!0,sessionId:i});return p.cookies.set("sessionId",i,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:86400}),p}catch(e){if(e instanceof p.jm)return s.NextResponse.json({error:"Invalid request"},{status:400});return console.error("Error in login:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/login/route",pathname:"/api/admin/login",filename:"route",bundlePath:"app/api/admin/login/route"},resolvedPagePath:"C:\\Users\\Admin\\Documents\\Project\\HotShield\\Server\\src\\app\\api\\admin\\login\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:A,serverHooks:h}=f,x="/api/admin/login/route";function y(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:A})}},9713:(e,t,n)=>{var r;n.d(t,{J:()=>a,V:()=>r}),function(e){e.REPORT_CREATED="REPORT_CREATED",e.VERDICT_CHANGED="VERDICT_CHANGED",e.REPORTER_BANNED="REPORTER_BANNED",e.CASE_VIEWED="CASE_VIEWED",e.ADMIN_LOGIN="ADMIN_LOGIN",e.ADMIN_LOGOUT="ADMIN_LOGOUT",e.STATE_TRANSITION="STATE_TRANSITION"}(r||(r={}));class a{constructor(e){this.collection=e.collection("audit_logs"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({timestamp:-1}),await this.collection.createIndex({actor:1}),await this.collection.createIndex({target:1}),await this.collection.createIndex({action:1})}async log(e){await this.collection.insertOne(e)}async findByTarget(e,t=100){return this.collection.find({target:e}).sort({timestamp:-1}).limit(t).toArray()}async findByActor(e,t=100){return this.collection.find({actor:e}).sort({timestamp:-1}).limit(t).toArray()}async findAll(e=1e3){return this.collection.find({}).sort({timestamp:-1}).limit(e).toArray()}}},8484:(e,t,n)=>{n.d(t,{N:()=>s});let r=require("mongodb"),a=process.env.MONGODB_URI,i={},o=null;async function s(){return(await function(){if(!process.env.MONGODB_URI)throw Error("Please add your Mongo URI to .env.local");return o||(o=new r.MongoClient(a,i).connect())}()).db()}},3482:(e,t,n)=>{n.d(t,{bh:()=>u,uV:()=>d,ed:()=>m,sd:()=>f,kF:()=>x,ZW:()=>p});var r=n(8484),a=n(2023),i=n.n(a),o=n(4770),s=n.n(o);async function c(){return(await (0,r.N)()).collection("admins")}async function l(){return(await (0,r.N)()).collection("sessions")}async function u(e){let t=await c();return null!==await t.findOne({username:e})}async function d(e,t){let n=await c();if(await n.findOne({username:e}))throw Error("Admin already exists");let r=await i().hash(t,10);await n.insertOne({username:e,passwordHash:r,createdAt:new Date().toISOString()})}async function p(e,t){let n=await c(),r=await n.findOne({username:e});return!!r&&i().compare(t,r.passwordHash)}async function m(e,t){let n=await l(),r=s().randomBytes(32).toString("hex"),a=new Date(Date.now()+864e5).toISOString();return await n.insertOne({sessionId:r,username:e,expiresAt:a,ipAddress:t}),r}async function w(e){let t=await l(),n=await t.findOne({sessionId:e});return n?new Date(n.expiresAt)<new Date?(await t.deleteOne({sessionId:e}),null):n.username:null}async function f(e){let t=await l();await t.deleteOne({sessionId:e})}var g=n(1615);let A=!1;async function h(){if(A)return;A=!0;let e=process.env.ADMIN_USERNAME,t=process.env.ADMIN_PASSWORD;if(e&&t&&"change_me_secure_password_here"!==t&&!(t.length<8))try{await u(e)||(await d(e,t),console.log(`[HotShield] Admin user "${e}" auto-created from environment variables`))}catch(e){"Admin already exists"!==e.message&&console.error("[HotShield] Error auto-creating admin from env:",e)}}async function x(e){await h();let t=await (0,g.cookies)(),n=e.headers.get("X-Session-Id")||t.get("sessionId")?.value||"";if(!n)return null;let r=await w(n);return r?{username:r}:null}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[276,972,28,585],()=>n(6446));module.exports=r})();