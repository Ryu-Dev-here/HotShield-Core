"use strict";(()=>{var e={};e.id=264,e.ids=[264],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},2163:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>f,routeModule:()=>w,serverHooks:()=>I,staticGenerationAsyncStorage:()=>y});var i={};n.r(i),n.d(i,{GET:()=>h});var r=n(9303),a=n(8716),s=n(670),o=n(7070),c=n(3482),l=n(8484),d=n(1590),u=n(7048),p=n(2631);async function h(e,{params:t}){if(!await (0,c.kF)(e))return o.NextResponse.json({error:"Unauthorized"},{status:401});try{let e=await (0,l.N)(),n=new d.Z(e),i=new u.w(e),r=new p.F(e),a=await n.findByUuid(t.uuid);if(!a)return o.NextResponse.json({error:"Not found"},{status:404});let s=await Promise.all(a.reports.map(e=>i.findByReportId(e))),c=await Promise.all(s.filter(e=>null!==e).map(e=>r.findByFingerprint(e.reporterFingerprint)));return o.NextResponse.json({case:a,reports:s.filter(e=>null!==e),reporters:c.filter(e=>null!==e)})}catch(e){return console.error("Error fetching case:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let w=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/cases/[uuid]/route",pathname:"/api/admin/cases/[uuid]",filename:"route",bundlePath:"app/api/admin/cases/[uuid]/route"},resolvedPagePath:"C:\\Users\\Admin\\Documents\\Project\\HotShield\\Server\\src\\app\\api\\admin\\cases\\[uuid]\\route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:I}=w,m="/api/admin/cases/[uuid]/route";function g(){return(0,s.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:y})}},1590:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(6338);class r{constructor(e){this.collection=e.collection("cases"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({targetUuid:1},{unique:!0}),await this.collection.createIndex({verdict:1}),await this.collection.createIndex({confidence:-1}),await this.collection.createIndex({lastUpdated:-1})}async create(e){await this.collection.insertOne(e)}async findByUuid(e){return this.collection.findOne({targetUuid:e})}async update(e){await this.collection.updateOne({targetUuid:e.targetUuid},{$set:e},{upsert:!0})}async findAllByVerdict(e){return this.collection.find({verdict:e}).toArray()}async findAllVerifiedAndPending(){return this.collection.find({verdict:{$in:[i.j.VERIFIED,i.j.PENDING]}}).toArray()}async updateVerdict(e,t,n){await this.collection.updateOne({targetUuid:e},{$set:{verdict:t,lastUpdated:new Date().toISOString()},$push:{timeline:n}})}}},7048:(e,t,n)=>{n.d(t,{w:()=>r});var i=n(5634);class r{constructor(e){this.collection=e.collection("reports"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({reportId:1},{unique:!0}),await this.collection.createIndex({targetUuid:1}),await this.collection.createIndex({reporterFingerprint:1}),await this.collection.createIndex({status:1}),await this.collection.createIndex({timestamp:-1}),await this.collection.createIndex({proofHashes:1})}async create(e){await this.collection.insertOne(e)}async findByReportId(e){return this.collection.findOne({reportId:e})}async findByTargetUuid(e){return this.collection.find({targetUuid:e}).toArray()}async findQueued(){return this.collection.find({status:i.R.QUEUED}).toArray()}async updateStatus(e,t,n){let i={status:t};void 0!==n&&(i.weight=n),await this.collection.updateOne({reportId:e},{$set:i})}async findByProofHash(e){return this.collection.find({proofHashes:e}).toArray()}async findByReporterFingerprint(e,t=100){return this.collection.find({reporterFingerprint:e}).sort({timestamp:-1}).limit(t).toArray()}}},2631:(e,t,n)=>{n.d(t,{F:()=>i});class i{constructor(e){this.collection=e.collection("reporters"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({fingerprint:1},{unique:!0}),await this.collection.createIndex({trustScore:-1}),await this.collection.createIndex({shadowBanned:1})}async findOrCreate(e){let t=await this.collection.findOne({fingerprint:e});if(t)return t;let n={fingerprint:e,trustScore:50,reportCount:0,verifiedCount:0,clearedCount:0,abuseFlags:[],shadowBanned:!1,createdAt:new Date().toISOString()};return await this.collection.insertOne(n),n}async findByFingerprint(e){return this.collection.findOne({fingerprint:e})}async update(e){await this.collection.updateOne({fingerprint:e.fingerprint},{$set:e})}async incrementReportCount(e){await this.collection.updateOne({fingerprint:e},{$inc:{reportCount:1},$set:{lastReportTime:new Date().toISOString()}})}async adjustTrustScore(e,t){let n=await this.findByFingerprint(e);if(!n)return;let i=Math.max(0,Math.min(100,n.trustScore+t));await this.collection.updateOne({fingerprint:e},{$set:{trustScore:i}})}async addAbuseFlag(e,t){await this.collection.updateOne({fingerprint:e},{$addToSet:{abuseFlags:t}})}async setShadowBanned(e,t){await this.collection.updateOne({fingerprint:e},{$set:{shadowBanned:t}})}async findAll(e=100){return this.collection.find({}).sort({trustScore:-1}).limit(e).toArray()}}},8484:(e,t,n)=>{n.d(t,{N:()=>o});let i=require("mongodb"),r=process.env.MONGODB_URI,a={},s=null;async function o(){return(await function(){if(!process.env.MONGODB_URI)throw Error("Please add your Mongo URI to .env.local");return s||(s=new i.MongoClient(r,a).connect())}()).db()}},3482:(e,t,n)=>{n.d(t,{bh:()=>d,uV:()=>u,ed:()=>h,sd:()=>f,kF:()=>g,ZW:()=>p});var i=n(8484),r=n(2023),a=n.n(r),s=n(4770),o=n.n(s);async function c(){return(await (0,i.N)()).collection("admins")}async function l(){return(await (0,i.N)()).collection("sessions")}async function d(e){let t=await c();return null!==await t.findOne({username:e})}async function u(e,t){let n=await c();if(await n.findOne({username:e}))throw Error("Admin already exists");let i=await a().hash(t,10);await n.insertOne({username:e,passwordHash:i,createdAt:new Date().toISOString()})}async function p(e,t){let n=await c(),i=await n.findOne({username:e});return!!i&&a().compare(t,i.passwordHash)}async function h(e,t){let n=await l(),i=o().randomBytes(32).toString("hex"),r=new Date(Date.now()+864e5).toISOString();return await n.insertOne({sessionId:i,username:e,expiresAt:r,ipAddress:t}),i}async function w(e){let t=await l(),n=await t.findOne({sessionId:e});return n?new Date(n.expiresAt)<new Date?(await t.deleteOne({sessionId:e}),null):n.username:null}async function f(e){let t=await l();await t.deleteOne({sessionId:e})}var y=n(1615);let I=!1;async function m(){if(I)return;I=!0;let e=process.env.ADMIN_USERNAME,t=process.env.ADMIN_PASSWORD;if(e&&t&&"change_me_secure_password_here"!==t&&!(t.length<8))try{await d(e)||(await u(e,t),console.log(`[HotShield] Admin user "${e}" auto-created from environment variables`))}catch(e){"Admin already exists"!==e.message&&console.error("[HotShield] Error auto-creating admin from env:",e)}}async function g(e){await m();let t=await (0,y.cookies)(),n=e.headers.get("X-Session-Id")||t.get("sessionId")?.value||"";if(!n)return null;let i=await w(n);return i?{username:i}:null}},6338:(e,t,n)=>{var i;n.d(t,{j:()=>i}),function(e){e.CLEAN="CLEAN",e.PENDING="PENDING",e.VERIFIED="VERIFIED",e.DISPUTED="DISPUTED",e.CLEARED="CLEARED"}(i||(i={}))},5634:(e,t,n)=>{var i,r;n.d(t,{R:()=>i}),function(e){e.QUEUED="QUEUED",e.PROCESSING="PROCESSING",e.WEIGHTED="WEIGHTED"}(i||(i={})),function(e){e.TRADE_SCAM="TRADE_SCAM",e.FAKE_MIDDLEMAN="FAKE_MIDDLEMAN",e.ACCOUNT_SCAM="ACCOUNT_SCAM",e.COIN_SCAM="COIN_SCAM",e.OTHER="OTHER"}(r||(r={}))}};var t=require("../../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),i=t.X(0,[276,972,28],()=>n(2163));module.exports=i})();