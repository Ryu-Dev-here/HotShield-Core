"use strict";(()=>{var e={};e.id=935,e.ids=[935],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},206:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>I,patchFetch:()=>O,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>w});var a={};n.r(a),n.d(a,{POST:()=>d});var i=n(9303),o=n(8716),r=n(670),s=n(7070),c=n(3482),l=n(9713),u=n(8484);async function d(e){let t=await (0,c.kF)(e);if(!t)return s.NextResponse.json({error:"Unauthorized"},{status:401});let n=e.headers.get("X-Session-Id")||e.cookies?.get("sessionId")?.value||"";n&&await (0,c.sd)(n);let a=await (0,u.N)(),i=new l.J(a);await i.log({action:l.V.ADMIN_LOGOUT,actor:t.username,timestamp:new Date().toISOString()});let o=s.NextResponse.json({success:!0});return o.cookies.delete("sessionId"),o}let p=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/logout/route",pathname:"/api/admin/logout",filename:"route",bundlePath:"app/api/admin/logout/route"},resolvedPagePath:"C:\\Users\\Admin\\Documents\\Project\\HotShield\\Server\\src\\app\\api\\admin\\logout\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:w,serverHooks:g}=p,I="/api/admin/logout/route";function O(){return(0,r.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:w})}},9713:(e,t,n)=>{var a;n.d(t,{J:()=>i,V:()=>a}),function(e){e.REPORT_CREATED="REPORT_CREATED",e.VERDICT_CHANGED="VERDICT_CHANGED",e.REPORTER_BANNED="REPORTER_BANNED",e.CASE_VIEWED="CASE_VIEWED",e.ADMIN_LOGIN="ADMIN_LOGIN",e.ADMIN_LOGOUT="ADMIN_LOGOUT",e.STATE_TRANSITION="STATE_TRANSITION"}(a||(a={}));class i{constructor(e){this.collection=e.collection("audit_logs"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({timestamp:-1}),await this.collection.createIndex({actor:1}),await this.collection.createIndex({target:1}),await this.collection.createIndex({action:1})}async log(e){await this.collection.insertOne(e)}async findByTarget(e,t=100){return this.collection.find({target:e}).sort({timestamp:-1}).limit(t).toArray()}async findByActor(e,t=100){return this.collection.find({actor:e}).sort({timestamp:-1}).limit(t).toArray()}async findAll(e=1e3){return this.collection.find({}).sort({timestamp:-1}).limit(e).toArray()}}},8484:(e,t,n)=>{n.d(t,{N:()=>s});let a=require("mongodb"),i=process.env.MONGODB_URI,o={},r=null;async function s(){return(await function(){if(!process.env.MONGODB_URI)throw Error("Please add your Mongo URI to .env.local");return r||(r=new a.MongoClient(i,o).connect())}()).db()}},3482:(e,t,n)=>{n.d(t,{uV:()=>u,ed:()=>p,sd:()=>w,kF:()=>I,ZW:()=>d});var a=n(8484),i=n(2023),o=n.n(i),r=n(4770),s=n.n(r);async function c(){return(await (0,a.N)()).collection("admins")}async function l(){return(await (0,a.N)()).collection("sessions")}async function u(e,t){let n=await c(),a=await o().hash(t,10);await n.insertOne({username:e,passwordHash:a,createdAt:new Date().toISOString()})}async function d(e,t){let n=await c(),a=await n.findOne({username:e});return!!a&&o().compare(t,a.passwordHash)}async function p(e,t){let n=await l(),a=s().randomBytes(32).toString("hex"),i=new Date(Date.now()+864e5).toISOString();return await n.insertOne({sessionId:a,username:e,expiresAt:i,ipAddress:t}),a}async function m(e){let t=await l(),n=await t.findOne({sessionId:e});return n?new Date(n.expiresAt)<new Date?(await t.deleteOne({sessionId:e}),null):n.username:null}async function w(e){let t=await l();await t.deleteOne({sessionId:e})}var g=n(1615);async function I(e){let t=await (0,g.cookies)(),n=e.headers.get("X-Session-Id")||t.get("sessionId")?.value||"";if(!n)return null;let a=await m(n);return a?{username:a}:null}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),a=t.X(0,[276,972,28],()=>n(206));module.exports=a})();