"use strict";(()=>{var t={};t.id=652,t.ids=[652],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5480:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>E,patchFetch:()=>I,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p});var n={};r.r(n),r.d(n,{POST:()=>l});var i=r(9303),a=r(8716),o=r(670),s=r(7070),c=r(6376);async function l(t){try{if(t.headers.get("authorization")!==`Bearer ${process.env.ANALYZE_SECRET||"secret"}`)return s.NextResponse.json({error:"Unauthorized"},{status:401});return await (0,c.Wl)(),s.NextResponse.json({success:!0})}catch(t){return console.error("Error in analyze endpoint:",t),s.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/analyze/route",pathname:"/api/analyze",filename:"route",bundlePath:"app/api/analyze/route"},resolvedPagePath:"C:\\Users\\Admin\\Documents\\Project\\HotShield\\Server\\src\\app\\api\\analyze\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:u,staticGenerationAsyncStorage:p,serverHooks:h}=d,E="/api/analyze/route";function I(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:p})}},9713:(t,e,r)=>{var n;r.d(e,{J:()=>i,V:()=>n}),function(t){t.REPORT_CREATED="REPORT_CREATED",t.VERDICT_CHANGED="VERDICT_CHANGED",t.REPORTER_BANNED="REPORTER_BANNED",t.CASE_VIEWED="CASE_VIEWED",t.ADMIN_LOGIN="ADMIN_LOGIN",t.ADMIN_LOGOUT="ADMIN_LOGOUT",t.STATE_TRANSITION="STATE_TRANSITION"}(n||(n={}));class i{constructor(t){this.collection=t.collection("audit_logs"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({timestamp:-1}),await this.collection.createIndex({actor:1}),await this.collection.createIndex({target:1}),await this.collection.createIndex({action:1})}async log(t){await this.collection.insertOne(t)}async findByTarget(t,e=100){return this.collection.find({target:t}).sort({timestamp:-1}).limit(e).toArray()}async findByActor(t,e=100){return this.collection.find({actor:t}).sort({timestamp:-1}).limit(e).toArray()}async findAll(t=1e3){return this.collection.find({}).sort({timestamp:-1}).limit(t).toArray()}}},1590:(t,e,r)=>{r.d(e,{Z:()=>i});var n=r(6338);class i{constructor(t){this.collection=t.collection("cases"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({targetUuid:1},{unique:!0}),await this.collection.createIndex({verdict:1}),await this.collection.createIndex({confidence:-1}),await this.collection.createIndex({lastUpdated:-1})}async create(t){await this.collection.insertOne(t)}async findByUuid(t){return this.collection.findOne({targetUuid:t})}async update(t){await this.collection.updateOne({targetUuid:t.targetUuid},{$set:t},{upsert:!0})}async findAllByVerdict(t){return this.collection.find({verdict:t}).toArray()}async findAllVerifiedAndPending(){return this.collection.find({verdict:{$in:[n.j.VERIFIED,n.j.PENDING]}}).toArray()}async updateVerdict(t,e,r){await this.collection.updateOne({targetUuid:t},{$set:{verdict:e,lastUpdated:new Date().toISOString()},$push:{timeline:r}})}}},7048:(t,e,r)=>{r.d(e,{w:()=>i});var n=r(5634);class i{constructor(t){this.collection=t.collection("reports"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({reportId:1},{unique:!0}),await this.collection.createIndex({targetUuid:1}),await this.collection.createIndex({reporterFingerprint:1}),await this.collection.createIndex({status:1}),await this.collection.createIndex({timestamp:-1}),await this.collection.createIndex({proofHashes:1})}async create(t){await this.collection.insertOne(t)}async findByReportId(t){return this.collection.findOne({reportId:t})}async findByTargetUuid(t){return this.collection.find({targetUuid:t}).toArray()}async findQueued(){return this.collection.find({status:n.R.QUEUED}).toArray()}async updateStatus(t,e,r){let n={status:e};void 0!==r&&(n.weight=r),await this.collection.updateOne({reportId:t},{$set:n})}async findByProofHash(t){return this.collection.find({proofHashes:t}).toArray()}async findByReporterFingerprint(t,e=100){return this.collection.find({reporterFingerprint:t}).sort({timestamp:-1}).limit(e).toArray()}}},2631:(t,e,r)=>{r.d(e,{F:()=>n});class n{constructor(t){this.collection=t.collection("reporters"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({fingerprint:1},{unique:!0}),await this.collection.createIndex({trustScore:-1}),await this.collection.createIndex({shadowBanned:1})}async findOrCreate(t){let e=await this.collection.findOne({fingerprint:t});if(e)return e;let r={fingerprint:t,trustScore:50,reportCount:0,verifiedCount:0,clearedCount:0,abuseFlags:[],shadowBanned:!1,createdAt:new Date().toISOString()};return await this.collection.insertOne(r),r}async findByFingerprint(t){return this.collection.findOne({fingerprint:t})}async update(t){await this.collection.updateOne({fingerprint:t.fingerprint},{$set:t})}async incrementReportCount(t){await this.collection.updateOne({fingerprint:t},{$inc:{reportCount:1},$set:{lastReportTime:new Date().toISOString()}})}async adjustTrustScore(t,e){let r=await this.findByFingerprint(t);if(!r)return;let n=Math.max(0,Math.min(100,r.trustScore+e));await this.collection.updateOne({fingerprint:t},{$set:{trustScore:n}})}async addAbuseFlag(t,e){await this.collection.updateOne({fingerprint:t},{$addToSet:{abuseFlags:e}})}async setShadowBanned(t,e){await this.collection.updateOne({fingerprint:t},{$set:{shadowBanned:e}})}async findAll(t=100){return this.collection.find({}).sort({trustScore:-1}).limit(t).toArray()}}},8484:(t,e,r)=>{r.d(e,{N:()=>s});let n=require("mongodb"),i=process.env.MONGODB_URI,a={},o=null;async function s(){return(await function(){if(!process.env.MONGODB_URI)throw Error("Please add your Mongo URI to .env.local");return o||(o=new n.MongoClient(i,a).connect())}()).db()}},6376:(t,e,r)=>{r.d(e,{G:()=>u,Wl:()=>h});var n=r(8484),i=r(7048),a=r(1590),o=r(2631),s=r(9713);let c={TRADE_SCAM:10,FAKE_MIDDLEMAN:8,ACCOUNT_SCAM:7,COIN_SCAM:9,OTHER:5};async function l(t,e,r){let n=function(t){if(t.shadowBanned)return 0;let e=t.trustScore,r=t.reportCount>0?t.verifiedCount/t.reportCount:0,n=t.reportCount>0?t.clearedCount/t.reportCount:0,i=.5*e;return r>.5?i+=20:r>.3&&(i+=10),n>.3&&(i-=15),Math.max(0,Math.min(50,i))}(e),i=0;t.proofLinks.length>0&&(i=Math.min(20,4*t.proofLinks.length));let a=15;for(let e of t.proofHashes)r.filter(t=>t.proofHashes.includes(e)).length>1&&(a-=3);a=Math.max(0,a);let o=c[t.category]||5,s=0,l=r.filter(e=>e.category===t.category);l.length>0&&(s=Math.min(5,l.length));let d=n+i+a+o+s;return{trustScore:n,proofQuality:i,proofUniqueness:a,categorySeverity:o,correlation:s,total:Math.max(0,Math.min(100,d))}}var d=r(6338);function u(t,e,r,n){return{from:t,to:e,timestamp:new Date().toISOString(),reason:r,actor:n}}var p=r(5634);async function h(){let t=await (0,n.N)(),e=new i.w(t),r=new a.Z(t),c=new o.F(t),h=new s.J(t);for(let t of(await e.findQueued()))try{var E,I,f;await e.updateStatus(t.reportId,p.R.PROCESSING);let n=await c.findByFingerprint(t.reporterFingerprint);if(!n||n.shadowBanned){await e.updateStatus(t.reportId,p.R.WEIGHTED,0);continue}let i=await r.findByUuid(t.targetUuid),a=i?await e.findByTargetUuid(t.targetUuid):[],o=await l(t,n,a);await e.updateStatus(t.reportId,p.R.WEIGHTED,o.total);let A=[...a,t],g=A.reduce((t,e)=>t+(e.weight||0),0),w=new Set(A.map(t=>t.reporterFingerprint)),y=A.filter(t=>{let e=a.find(e=>e.reporterFingerprint===t.reporterFingerprint);return!!e&&(e.weight||0)>40}),S={};for(let t of A)for(let e of t.proofHashes)S[e]=(S[e]||0)+1;let D=[];A.length>=3&&D.push("MULTIPLE_REPORTS"),Object.values(S).some(t=>t>1)&&D.push("PROOF_OVERLAP");let O=function(t,e,r){let n=Math.min(100,t);return n+=Math.min(20,2*r),Math.max(0,Math.min(100,n+=Math.min(15,3*e)))}(g,A.length,w.size),m=(E=i||{targetUuid:t.targetUuid,verdict:d.j.CLEAN,confidence:0,reports:[],timeline:[],proofOverlap:{},reporterDiversity:[],patternMatches:[],lastUpdated:new Date().toISOString(),createdAt:new Date().toISOString()},I=A.length,f=y.length,E.verdict===d.j.CLEARED?d.j.CLEARED:0===I||g<30?d.j.CLEAN:g>=70&&f>=2&&I>=3?E.verdict===d.j.VERIFIED&&E.reports.filter((t,e)=>!1).length>0&&f>=3?d.j.DISPUTED:d.j.VERIFIED:g>=40||I>=2?d.j.PENDING:d.j.CLEAN),R={targetUuid:t.targetUuid,verdict:m,confidence:O,reports:A.map(t=>t.reportId),timeline:i?[...i.timeline,u(i.verdict,m,"Analysis engine")]:[u(d.j.CLEAN,m,"Initial report")],proofOverlap:S,reporterDiversity:Array.from(w),patternMatches:D,lastUpdated:new Date().toISOString(),createdAt:i?.createdAt||new Date().toISOString()};if(await r.update(R),i&&i.verdict!==m&&await h.log({action:s.V.STATE_TRANSITION,actor:"system",target:t.targetUuid,beforeState:i.verdict,afterState:m,timestamp:new Date().toISOString(),metadata:{reportId:t.reportId,confidence:O}}),m===d.j.VERIFIED){await c.adjustTrustScore(t.reporterFingerprint,5);let e=await c.findByFingerprint(t.reporterFingerprint);e&&(e.verifiedCount++,await c.update(e))}}catch(r){console.error(`Error processing report ${t.reportId}:`,r),await e.updateStatus(t.reportId,p.R.QUEUED)}}},6338:(t,e,r)=>{var n;r.d(e,{j:()=>n}),function(t){t.CLEAN="CLEAN",t.PENDING="PENDING",t.VERIFIED="VERIFIED",t.DISPUTED="DISPUTED",t.CLEARED="CLEARED"}(n||(n={}))},5634:(t,e,r)=>{var n,i;r.d(e,{R:()=>n}),function(t){t.QUEUED="QUEUED",t.PROCESSING="PROCESSING",t.WEIGHTED="WEIGHTED"}(n||(n={})),function(t){t.TRADE_SCAM="TRADE_SCAM",t.FAKE_MIDDLEMAN="FAKE_MIDDLEMAN",t.ACCOUNT_SCAM="ACCOUNT_SCAM",t.COIN_SCAM="COIN_SCAM",t.OTHER="OTHER"}(i||(i={}))}};var e=require("../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),n=e.X(0,[276,972],()=>r(5480));module.exports=n})();