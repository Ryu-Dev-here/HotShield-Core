"use strict";(()=>{var t={};t.id=232,t.ids=[232],t.modules={2934:t=>{t.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:t=>{t.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:t=>{t.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:t=>{t.exports=require("crypto")},7275:(t,e,n)=>{n.r(e),n.d(e,{originalPathname:()=>m,patchFetch:()=>S,requestAsyncStorage:()=>g,routeModule:()=>E,serverHooks:()=>A,staticGenerationAsyncStorage:()=>y});var r={};n.r(r),n.d(r,{POST:()=>w});var i=n(9303),a=n(8716),o=n(670),s=n(7070),c=n(3482),d=n(8484),l=n(1590),u=n(9713),p=n(6376),h=n(1585),f=n(6033);let I=h.Ry({verdict:h.Km(["CLEAN","PENDING","VERIFIED","DISPUTED","CLEARED"]),reason:h.Z_().optional()});async function w(t,{params:e}){let n=await (0,c.kF)(t);if(!n)return s.NextResponse.json({error:"Unauthorized"},{status:401});try{let r=await t.json(),{verdict:i,reason:a}=I.parse(r),o=await (0,d.N)(),c=new l.Z(o),h=new u.J(o),f=await c.findByUuid(e.uuid);if(!f)return s.NextResponse.json({error:"Not found"},{status:404});let w=(0,p.G)(f.verdict,i,a||"Manual override",n.username);return await c.updateVerdict(e.uuid,i,w),await h.log({action:u.V.VERDICT_CHANGED,actor:n.username,target:e.uuid,beforeState:f.verdict,afterState:i,timestamp:new Date().toISOString(),ipAddress:t.headers.get("x-forwarded-for")||void 0,metadata:{reason:a}}),s.NextResponse.json({success:!0})}catch(t){if(t instanceof f.jm)return s.NextResponse.json({error:"Invalid request"},{status:400});return console.error("Error updating verdict:",t),s.NextResponse.json({error:"Internal server error"},{status:500})}}let E=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/cases/[uuid]/verdict/route",pathname:"/api/admin/cases/[uuid]/verdict",filename:"route",bundlePath:"app/api/admin/cases/[uuid]/verdict/route"},resolvedPagePath:"C:\\Users\\Admin\\Documents\\Project\\HotShield\\Server\\src\\app\\api\\admin\\cases\\[uuid]\\verdict\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:A}=E,m="/api/admin/cases/[uuid]/verdict/route";function S(){return(0,o.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:y})}},9713:(t,e,n)=>{var r;n.d(e,{J:()=>i,V:()=>r}),function(t){t.REPORT_CREATED="REPORT_CREATED",t.VERDICT_CHANGED="VERDICT_CHANGED",t.REPORTER_BANNED="REPORTER_BANNED",t.CASE_VIEWED="CASE_VIEWED",t.ADMIN_LOGIN="ADMIN_LOGIN",t.ADMIN_LOGOUT="ADMIN_LOGOUT",t.STATE_TRANSITION="STATE_TRANSITION"}(r||(r={}));class i{constructor(t){this.collection=t.collection("audit_logs"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({timestamp:-1}),await this.collection.createIndex({actor:1}),await this.collection.createIndex({target:1}),await this.collection.createIndex({action:1})}async log(t){await this.collection.insertOne(t)}async findByTarget(t,e=100){return this.collection.find({target:t}).sort({timestamp:-1}).limit(e).toArray()}async findByActor(t,e=100){return this.collection.find({actor:t}).sort({timestamp:-1}).limit(e).toArray()}async findAll(t=1e3){return this.collection.find({}).sort({timestamp:-1}).limit(t).toArray()}}},1590:(t,e,n)=>{n.d(e,{Z:()=>i});var r=n(6338);class i{constructor(t){this.collection=t.collection("cases"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({targetUuid:1},{unique:!0}),await this.collection.createIndex({verdict:1}),await this.collection.createIndex({confidence:-1}),await this.collection.createIndex({lastUpdated:-1})}async create(t){await this.collection.insertOne(t)}async findByUuid(t){return this.collection.findOne({targetUuid:t})}async update(t){await this.collection.updateOne({targetUuid:t.targetUuid},{$set:t},{upsert:!0})}async findAllByVerdict(t){return this.collection.find({verdict:t}).toArray()}async findAllVerifiedAndPending(){return this.collection.find({verdict:{$in:[r.j.VERIFIED,r.j.PENDING]}}).toArray()}async updateVerdict(t,e,n){await this.collection.updateOne({targetUuid:t},{$set:{verdict:e,lastUpdated:new Date().toISOString()},$push:{timeline:n}})}}},7048:(t,e,n)=>{n.d(e,{w:()=>i});var r=n(5634);class i{constructor(t){this.collection=t.collection("reports"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({reportId:1},{unique:!0}),await this.collection.createIndex({targetUuid:1}),await this.collection.createIndex({reporterFingerprint:1}),await this.collection.createIndex({status:1}),await this.collection.createIndex({timestamp:-1}),await this.collection.createIndex({proofHashes:1})}async create(t){await this.collection.insertOne(t)}async findByReportId(t){return this.collection.findOne({reportId:t})}async findByTargetUuid(t){return this.collection.find({targetUuid:t}).toArray()}async findQueued(){return this.collection.find({status:r.R.QUEUED}).toArray()}async updateStatus(t,e,n){let r={status:e};void 0!==n&&(r.weight=n),await this.collection.updateOne({reportId:t},{$set:r})}async findByProofHash(t){return this.collection.find({proofHashes:t}).toArray()}async findByReporterFingerprint(t,e=100){return this.collection.find({reporterFingerprint:t}).sort({timestamp:-1}).limit(e).toArray()}}},2631:(t,e,n)=>{n.d(e,{F:()=>r});class r{constructor(t){this.collection=t.collection("reporters"),this.ensureIndexes()}async ensureIndexes(){await this.collection.createIndex({fingerprint:1},{unique:!0}),await this.collection.createIndex({trustScore:-1}),await this.collection.createIndex({shadowBanned:1})}async findOrCreate(t){let e=await this.collection.findOne({fingerprint:t});if(e)return e;let n={fingerprint:t,trustScore:50,reportCount:0,verifiedCount:0,clearedCount:0,abuseFlags:[],shadowBanned:!1,createdAt:new Date().toISOString()};return await this.collection.insertOne(n),n}async findByFingerprint(t){return this.collection.findOne({fingerprint:t})}async update(t){await this.collection.updateOne({fingerprint:t.fingerprint},{$set:t})}async incrementReportCount(t){await this.collection.updateOne({fingerprint:t},{$inc:{reportCount:1},$set:{lastReportTime:new Date().toISOString()}})}async adjustTrustScore(t,e){let n=await this.findByFingerprint(t);if(!n)return;let r=Math.max(0,Math.min(100,n.trustScore+e));await this.collection.updateOne({fingerprint:t},{$set:{trustScore:r}})}async addAbuseFlag(t,e){await this.collection.updateOne({fingerprint:t},{$addToSet:{abuseFlags:e}})}async setShadowBanned(t,e){await this.collection.updateOne({fingerprint:t},{$set:{shadowBanned:e}})}async findAll(t=100){return this.collection.find({}).sort({trustScore:-1}).limit(t).toArray()}}},8484:(t,e,n)=>{n.d(e,{N:()=>s});let r=require("mongodb"),i=process.env.MONGODB_URI,a={},o=null;async function s(){return(await function(){if(!process.env.MONGODB_URI)throw Error("Please add your Mongo URI to .env.local");return o||(o=new r.MongoClient(i,a).connect())}()).db()}},6376:(t,e,n)=>{n.d(e,{G:()=>u,Wl:()=>h});var r=n(8484),i=n(7048),a=n(1590),o=n(2631),s=n(9713);let c={TRADE_SCAM:10,FAKE_MIDDLEMAN:8,ACCOUNT_SCAM:7,COIN_SCAM:9,OTHER:5};async function d(t,e,n){let r=function(t){if(t.shadowBanned)return 0;let e=t.trustScore,n=t.reportCount>0?t.verifiedCount/t.reportCount:0,r=t.reportCount>0?t.clearedCount/t.reportCount:0,i=.5*e;return n>.5?i+=20:n>.3&&(i+=10),r>.3&&(i-=15),Math.max(0,Math.min(50,i))}(e),i=0;t.proofLinks.length>0&&(i=Math.min(20,4*t.proofLinks.length));let a=15;for(let e of t.proofHashes)n.filter(t=>t.proofHashes.includes(e)).length>1&&(a-=3);a=Math.max(0,a);let o=c[t.category]||5,s=0,d=n.filter(e=>e.category===t.category);d.length>0&&(s=Math.min(5,d.length));let l=r+i+a+o+s;return{trustScore:r,proofQuality:i,proofUniqueness:a,categorySeverity:o,correlation:s,total:Math.max(0,Math.min(100,l))}}var l=n(6338);function u(t,e,n,r){return{from:t,to:e,timestamp:new Date().toISOString(),reason:n,actor:r}}var p=n(5634);async function h(){let t=await (0,r.N)(),e=new i.w(t),n=new a.Z(t),c=new o.F(t),h=new s.J(t);for(let t of(await e.findQueued()))try{var f,I,w;await e.updateStatus(t.reportId,p.R.PROCESSING);let r=await c.findByFingerprint(t.reporterFingerprint);if(!r||r.shadowBanned){await e.updateStatus(t.reportId,p.R.WEIGHTED,0);continue}let i=await n.findByUuid(t.targetUuid),a=i?await e.findByTargetUuid(t.targetUuid):[],o=await d(t,r,a);await e.updateStatus(t.reportId,p.R.WEIGHTED,o.total);let E=[...a,t],g=E.reduce((t,e)=>t+(e.weight||0),0),y=new Set(E.map(t=>t.reporterFingerprint)),A=E.filter(t=>{let e=a.find(e=>e.reporterFingerprint===t.reporterFingerprint);return!!e&&(e.weight||0)>40}),m={};for(let t of E)for(let e of t.proofHashes)m[e]=(m[e]||0)+1;let S=[];E.length>=3&&S.push("MULTIPLE_REPORTS"),Object.values(m).some(t=>t>1)&&S.push("PROOF_OVERLAP");let D=function(t,e,n){let r=Math.min(100,t);return r+=Math.min(20,2*n),Math.max(0,Math.min(100,r+=Math.min(15,3*e)))}(g,E.length,y.size),O=(f=i||{targetUuid:t.targetUuid,verdict:l.j.CLEAN,confidence:0,reports:[],timeline:[],proofOverlap:{},reporterDiversity:[],patternMatches:[],lastUpdated:new Date().toISOString(),createdAt:new Date().toISOString()},I=E.length,w=A.length,f.verdict===l.j.CLEARED?l.j.CLEARED:0===I||g<30?l.j.CLEAN:g>=70&&w>=2&&I>=3?f.verdict===l.j.VERIFIED&&f.reports.filter((t,e)=>!1).length>0&&w>=3?l.j.DISPUTED:l.j.VERIFIED:g>=40||I>=2?l.j.PENDING:l.j.CLEAN),R={targetUuid:t.targetUuid,verdict:O,confidence:D,reports:E.map(t=>t.reportId),timeline:i?[...i.timeline,u(i.verdict,O,"Analysis engine")]:[u(l.j.CLEAN,O,"Initial report")],proofOverlap:m,reporterDiversity:Array.from(y),patternMatches:S,lastUpdated:new Date().toISOString(),createdAt:i?.createdAt||new Date().toISOString()};if(await n.update(R),i&&i.verdict!==O&&await h.log({action:s.V.STATE_TRANSITION,actor:"system",target:t.targetUuid,beforeState:i.verdict,afterState:O,timestamp:new Date().toISOString(),metadata:{reportId:t.reportId,confidence:D}}),O===l.j.VERIFIED){await c.adjustTrustScore(t.reporterFingerprint,5);let e=await c.findByFingerprint(t.reporterFingerprint);e&&(e.verifiedCount++,await c.update(e))}}catch(n){console.error(`Error processing report ${t.reportId}:`,n),await e.updateStatus(t.reportId,p.R.QUEUED)}}},3482:(t,e,n)=>{n.d(e,{uV:()=>l,ed:()=>p,sd:()=>f,kF:()=>w,ZW:()=>u});var r=n(8484),i=n(2023),a=n.n(i),o=n(4770),s=n.n(o);async function c(){return(await (0,r.N)()).collection("admins")}async function d(){return(await (0,r.N)()).collection("sessions")}async function l(t,e){let n=await c(),r=await a().hash(e,10);await n.insertOne({username:t,passwordHash:r,createdAt:new Date().toISOString()})}async function u(t,e){let n=await c(),r=await n.findOne({username:t});return!!r&&a().compare(e,r.passwordHash)}async function p(t,e){let n=await d(),r=s().randomBytes(32).toString("hex"),i=new Date(Date.now()+864e5).toISOString();return await n.insertOne({sessionId:r,username:t,expiresAt:i,ipAddress:e}),r}async function h(t){let e=await d(),n=await e.findOne({sessionId:t});return n?new Date(n.expiresAt)<new Date?(await e.deleteOne({sessionId:t}),null):n.username:null}async function f(t){let e=await d();await e.deleteOne({sessionId:t})}var I=n(1615);async function w(t){let e=await (0,I.cookies)(),n=t.headers.get("X-Session-Id")||e.get("sessionId")?.value||"";if(!n)return null;let r=await h(n);return r?{username:r}:null}},6338:(t,e,n)=>{var r;n.d(e,{j:()=>r}),function(t){t.CLEAN="CLEAN",t.PENDING="PENDING",t.VERIFIED="VERIFIED",t.DISPUTED="DISPUTED",t.CLEARED="CLEARED"}(r||(r={}))},5634:(t,e,n)=>{var r,i;n.d(e,{R:()=>r}),function(t){t.QUEUED="QUEUED",t.PROCESSING="PROCESSING",t.WEIGHTED="WEIGHTED"}(r||(r={})),function(t){t.TRADE_SCAM="TRADE_SCAM",t.FAKE_MIDDLEMAN="FAKE_MIDDLEMAN",t.ACCOUNT_SCAM="ACCOUNT_SCAM",t.COIN_SCAM="COIN_SCAM",t.OTHER="OTHER"}(i||(i={}))}};var e=require("../../../../../../webpack-runtime.js");e.C(t);var n=t=>e(e.s=t),r=e.X(0,[276,972,28,585],()=>n(7275));module.exports=r})();